<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="886" height="1610" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[ .actor { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);} text.actor { fill: black; stroke: none;} .actor-line { stroke: grey;} .messageLine0 { stroke-width: 1.5; stroke: rgb(51, 51, 51);} .messageLine1 { stroke-width: 1.5; stroke: rgb(51, 51, 51);} #arrowhead { fill: rgb(51, 51, 51);} #crosshead path { fill: rgb(51, 51, 51) !important; stroke: rgb(51, 51, 51) !important;} .messageText { fill: rgb(51, 51, 51); stroke: none;} .labelBox { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);} .labelText { fill: black; stroke: none;} .loopText { fill: black; stroke: none;} .loopLine { stroke-width: 2; stroke: rgb(204, 204, 255);} .note { stroke: rgb(170, 170, 51); fill: rgb(255, 245, 173);} .noteText { fill: black; stroke: none; font-family: "trebuchet ms", verdana, arial; font-size: 14px;} 微信支付用户微信客户端商户后台系统微信支付系统1.生成图文消息链接或二维码()展示给用户()2. 点击消息或扫描二维码在微信浏览器打开商户H5网页()网页内请求生成支付订单()4.生成商户订单()5.调用统一下单API()生成预付单()返回预付单消息(prepay_id)6.生成JSAPI页面调用的支付参数并签名()返回支付参数(prepay_id.paySign等)7.用户点击发起支付()JSAPI接口请求支付()8.检查参数合法性和授权域权限()返回验证结果，并要求支付授权()提示输入密码()9.确认支付，输入密码()验证授权()alt:并行处理 -10,11,1210.异步通知商户支付结果()11.告知微信通知处理结果()12.返回支付结果，并发微信消息提示()展示支付信息给用户()微信跳转回商户H5页面()13.查询商户后台支付结果()alt:支付结果 -14及返回[未收到支付通知]14.调用查询API，查询支付结果()返回支付结果()返回支付结果()15.商户发货及支付后个性化页面提示()微信支付用户微信客户端商户后台系统微信支付系统sd H5网页支付模式]]></source><style type="text/css" title="mermaid-svg-internal-css"> .actor { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);} text.actor { fill: black; stroke: none;} .actor-line { stroke: grey;} .messageLine0 { stroke-width: 1.5; stroke: rgb(51, 51, 51);} .messageLine1 { stroke-width: 1.5; stroke: rgb(51, 51, 51);} #arrowhead { fill: rgb(51, 51, 51);} #crosshead path { fill: rgb(51, 51, 51) !important; stroke: rgb(51, 51, 51) !important;} .messageText { fill: rgb(51, 51, 51); stroke: none;} .labelBox { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);} .labelText { fill: black; stroke: none;} .loopText { fill: black; stroke: none;} .loopLine { stroke-width: 2; stroke: rgb(204, 204, 255);} .note { stroke: rgb(170, 170, 51); fill: rgb(255, 245, 173);} .noteText { fill: black; stroke: none; font-family: "trebuchet ms", verdana, arial; font-size: 14px;} </style><g></g><g><line id="actor3" x1="75" y1="5" x2="75" y2="1569" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="37.5" class="actor" style="text-anchor: middle;">微信支付用户</text></g><g><line id="actor4" x1="275" y1="5" x2="275" y2="1569" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="37.5" class="actor" style="text-anchor: middle;">微信客户端</text></g><g><line id="actor5" x1="475" y1="5" x2="475" y2="1569" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="37.5" class="actor" style="text-anchor: middle;">商户后台系统</text></g><g><line id="actor6" x1="675" y1="5" x2="675" y2="1569" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="37.5" class="actor" style="text-anchor: middle;">微信支付系统</text></g><defs><marker id="arrowhead" refX="5" refY="2" markerWidth="6" markerHeight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><g><text x="475" y="93" class="messageText" style="text-anchor: middle;">1.生成图文消息链接或二维码()</text><path d="M 475,100 C 535,90 535,130 475,120" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="275" y="158" class="messageText" style="text-anchor: middle;">展示给用户()</text><line x1="475" y1="165" x2="75" y2="165" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="175" y="193" class="messageText" style="text-anchor: middle;">2. 点击消息或扫描二维码在微信浏览器打开商户H5网页()</text><line x1="75" y1="200" x2="275" y2="200" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="375" y="228" class="messageText" style="text-anchor: middle;">网页内请求生成支付订单()</text><line x1="275" y1="235" x2="475" y2="235" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="475" y="263" class="messageText" style="text-anchor: middle;">4.生成商户订单()</text><path d="M 475,270 C 535,260 535,300 475,290" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="575" y="328" class="messageText" style="text-anchor: middle;">5.调用统一下单API()</text><line x1="475" y1="335" x2="675" y2="335" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="675" y="363" class="messageText" style="text-anchor: middle;">生成预付单()</text><path d="M 675,370 C 735,360 735,400 675,390" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="575" y="428" class="messageText" style="text-anchor: middle;">返回预付单消息(prepay_id)</text><line x1="675" y1="435" x2="475" y2="435" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="475" y="463" class="messageText" style="text-anchor: middle;">6.生成JSAPI页面调用的支付参数并签名()</text><path d="M 475,470 C 535,460 535,500 475,490" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="375" y="528" class="messageText" style="text-anchor: middle;">返回支付参数(prepay_id.paySign等)</text><line x1="475" y1="535" x2="275" y2="535" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="175" y="563" class="messageText" style="text-anchor: middle;">7.用户点击发起支付()</text><line x1="75" y1="570" x2="275" y2="570" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="475" y="598" class="messageText" style="text-anchor: middle;">JSAPI接口请求支付()</text><line x1="275" y1="605" x2="675" y2="605" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="675" y="633" class="messageText" style="text-anchor: middle;">8.检查参数合法性和授权域权限()</text><path d="M 675,640 C 735,630 735,670 675,660" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="475" y="698" class="messageText" style="text-anchor: middle;">返回验证结果，并要求支付授权()</text><line x1="675" y1="705" x2="275" y2="705" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="275" y="733" class="messageText" style="text-anchor: middle;">提示输入密码()</text><path d="M 275,740 C 335,730 335,770 275,760" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="175" y="798" class="messageText" style="text-anchor: middle;">9.确认支付，输入密码()</text><line x1="75" y1="805" x2="275" y2="805" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="475" y="833" class="messageText" style="text-anchor: middle;">验证授权()</text><line x1="275" y1="840" x2="675" y2="840" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><rect x="100" y="850" fill="#EDF2AE" stroke="#666" width="150" height="68" rx="0" ry="0" class="note"></rect><text x="116" y="884" fill="black" class="noteText"><tspan x="116">alt:并行处理 -</tspan><tspan dy="27" x="116">10,11,12</tspan></text></g><g><text x="575" y="946" class="messageText" style="text-anchor: middle;">10.异步通知商户支付结果()</text><line x1="675" y1="953" x2="475" y2="953" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="575" y="981" class="messageText" style="text-anchor: middle;">11.告知微信通知处理结果()</text><line x1="475" y1="988" x2="675" y2="988" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="475" y="1016" class="messageText" style="text-anchor: middle;">12.返回支付结果，并发微信消息提示()</text><line x1="675" y1="1023" x2="275" y2="1023" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="175" y="1051" class="messageText" style="text-anchor: middle;">展示支付信息给用户()</text><line x1="275" y1="1058" x2="75" y2="1058" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="275" y="1086" class="messageText" style="text-anchor: middle;">微信跳转回商户H5页面()</text><path d="M 275,1093 C 335,1083 335,1123 275,1113" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><text x="375" y="1151" class="messageText" style="text-anchor: middle;">13.查询商户后台支付结果()</text><line x1="275" y1="1158" x2="475" y2="1158" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><rect x="500" y="1168" fill="#EDF2AE" stroke="#666" width="150" height="68" rx="0" ry="0" class="note"></rect><text x="516" y="1202" fill="black" class="noteText"><tspan x="516">alt:支付结果 -</tspan><tspan dy="27" x="516">14及返回</tspan></text></g><g><rect x="500" y="1246" fill="#EDF2AE" stroke="#666" width="150" height="68" rx="0" ry="0" class="note"></rect><text x="516" y="1280" fill="black" class="noteText"><tspan x="516">[未收到支付通知</tspan><tspan dy="27" x="516">]</tspan></text></g><g><text x="575" y="1342" class="messageText" style="text-anchor: middle;">14.调用查询API，查询支付结果()</text><line x1="475" y1="1349" x2="675" y2="1349" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></line></g><g><text x="575" y="1377" class="messageText" style="text-anchor: middle;">返回支付结果()</text><line x1="675" y1="1384" x2="475" y2="1384" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="375" y="1412" class="messageText" style="text-anchor: middle;">返回支付结果()</text><line x1="475" y1="1419" x2="275" y2="1419" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></g><g><text x="275" y="1447" class="messageText" style="text-anchor: middle;">15.商户发货及支付后个性化页面提示()</text><path d="M 275,1454 C 335,1444 335,1484 275,1474" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"></path></g><g><rect x="0" y="1504" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="1541.5" class="actor" style="text-anchor: middle;">微信支付用户</text></g><g><rect x="200" y="1504" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="275" y="1541.5" class="actor" style="text-anchor: middle;">微信客户端</text></g><g><rect x="400" y="1504" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="475" y="1541.5" class="actor" style="text-anchor: middle;">商户后台系统</text></g><g><rect x="600" y="1504" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="675" y="1541.5" class="actor" style="text-anchor: middle;">微信支付系统</text></g><text x="295.48046875" y="-25">sd H5网页支付模式</text></svg>